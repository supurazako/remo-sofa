# 要件

## 1.ビジネス要件

- 1.1. プロダクトローンチ
  - 1.1.1. Webアプリケーションの公開
    - 新雪プログラム期間内に、主要機能を実装したWebアプリケーションを一般公開し、ユーザーが利用可能な状態にする。
  - 1.1.2. 初期ユーザー獲得
    - SNS等を通じた広報活動により、リリース後1ヶ月以内に100人のMAUを獲得する。

- 1.2. 利用シーンの拡大
  - 1.2.1. 教育・研修分野での活用促進
    - プロダクトの特性を活かし、オンライン教育や企業研修での利用事例を創出し、2団体以上での試験導入を目指す (期間後の目標への布石)。
  - 1.2.2. コミュニティ形成の基盤構築
    - アプリケーション利用を通じて、ユーザー間の交流やフィードバックが生まれるような仕組みの導入を検討し、将来的なコミュニティ形成の土台を作る。
    - アプリのOSS化及びドキュメントの整備、contributeのガイドラインの作成

## 2.ユーザー要件

- 2.1. リアルタイム共同視聴体験
  - 2.1.1. 動画の同時操作
    - 複数のユーザーが、あたかも同じ部屋でリモコンを操作するように、再生、一時停止、巻き戻し、早送り、リピート再生といった動画操作をリアルタイムに同期できること。
  - 2.1.2. 感覚の共有
    - 動画の特定箇所に対する注目点や意見を、遅延なく共有できること（マーカー機能を通じて）。
- 2.2. 簡単な動画共有プロセス
  - 2.2.1. 手軽な共有開始
    - ホストは、ローカルの動画ファイルを複雑な事前準備なしに、数クリックでセッションを開始し、他のユーザーと共有できること。
  - 2.2.2. 直感的な参加
    - ゲストは、共有されたセッションID（またはリンク）を用いて、簡単にセッションに参加できること。
- 2.3. パーソナライズと継続利用
  - 2.3.1. アカウントによる情報保持
    - ユーザーアカウントを作成・ログインすることで、過去のセッション履歴（参加履歴、主要なマークアップなど、プライバシーに配慮した範囲で）や個人設定を保持できること。

## 3. 機能要件

- 3.1. セッション管理機能
  - 3.1.1. セッション作成
    - ユーザーが新しい動画共有セッションを作成できる。
  - 3.1.2. セッションID発行・共有
    - 作成されたセッションには一意のIDが発行され、他者に共有できる。
  - 3.1.3. セッション参加
    - ユーザーがセッションIDを用いて既存のセッションに参加できる。
  - 3.1.4. セッション終了
    - ホスト（または最後の参加者）がセッションを終了できる。
  - 3.1.5. 参加者リスト表示
    - 現在セッションに参加しているユーザーのリストを表示できる。
- 3.2. 動画共有・再生機能
  - 3.2.1. 動画アップロード (ホスト)
    - ホストがローカルの動画ファイル (対応形式: MP4, MOV等) をサーバーにアップロードできる (tus.ioプロトコル準拠)。
  - 3.2.2. ストリーミング再生 (HLS)
    - アップロードされた動画はHLS形式に変換され、参加者全員がストリーミング再生できる。
  - 3.2.3. 動画操作同期
    - 再生/一時停止の同期。
    - シークバー操作による再生位置の同期（巻き戻し、早送り）。
    - リピート再生のON/OFF同期 (オプション)。
    - 音量調整の同期 (オプション、個別の音量調整も可能とするか検討)。
  - 3.2.4. 現在の操作者表示 (任意)
    - 誰が操作を行ったかを一時的に表示する。
- 3.3. マーカー機能
  - 3.3.1. マーカー描画
    - 動画上の任意の場所に、 predefined な図形（矢印、円、四角）やフリーハンドの線を描画できる。
  - 3.3.2. マーカーの色・太さ選択
    - 描画するマーカーの色や太さを選択できる。
  - 3.3.3. マーカーのリアルタイム同期
    - 描画されたマーカーは、リアルタイムに他の参加者の画面にも表示される。
  - 3.3.4. マーカーの所有者表示
    - 誰が描画したマーカーか識別できるようにする（例: 色分け、名前タグ）。
  - 3.3.5. マーカー削除
    - 自身が描画したマーカー、またはホストが任意のマーカーを削除できる。
  - 3.3.6. マーカーの持続時間設定 (オプション)
    - マーカーが一定時間で自動的に消えるオプション。
- 3.4. ユーザーアカウント機能
  - 3.4.1. ユーザー登録
    - メールアドレスとパスワードによる新規ユーザー登録。
  - 3.4.2. ログイン/ログアウト
    - 登録済みユーザーのログイン、ログアウト機能。
  - 3.4.3. ユーザー情報更新 (任意)
    - ニックネーム、パスワード変更など。
- 3.5. (Could-have) テキストチャット機能
  - セッション参加者間でリアルタイムにテキストメッセージを送受信できる。

## 4. 非機能要件

- 4.1. 性能 (Performance)
  - 4.1.1. 操作同期の遅延

    |対象|理想(ms)|許容(ms)|MVP(ms)|
    |---|---|---|---|
    |動画操作同期|100|300|500|
    |マーカー同期|150|500|1000|
    |テキストチャット|500|1000|2000|
    |カーソル位置共有|100|250|500|

  - 4.1.2. ストリーミング開始時間
    - 理想: within 10s
    - 許容: within 15s
    - MVP: within 30s
  - 4.1.3. 同時接続セッション数
    - 理想: 1000セッション
    - 許容: 500セッション
    - MVP: 50セッション
  - 4.1.4. セッション参加者数
    - 理想: 100人
    - 許容: 50人
    - MVP: 5人
- 4.2. セキュリティ (Security)
  - 4.2.1. 通信の暗号化
    - 全てのクライアント・サーバー間通信はHTTPS/WSSにより暗号化する。
  - 4.2.2. ユーザー認証
    - AWS Cognito を使用
    - メール/パスワード認証
    - ソーシャルログイン
    - 理想: 二要素認証の実装
  - 4.2.3. データ保護
    - アップロードされた動画ファイルは、セッション終了後1時間以内にサーバーから自動的に削除
    - パスワードは不可逆的なハッシュ関数（例: bcrypt, scrypt）とソルトを用いてハッシュ化され、平文では一切保存しない
    - 関連するプライバシーポリシーを明示し、ユーザーは自身の情報がどのように扱われるかを確認できるようにする
    - 不正アクセスやデータ漏洩を防止するため、ファイアウォール、侵入検知/防御システム（IDS/IPS）、定期的な脆弱性診断などのセキュリティ対策を実施する。万が一、データ漏洩が発生した場合には、速やかに影響範囲を特定し、関係各所への通知と適切な対応を行う。
  - 4.2.4. 脆弱性対策
    - OWASP Top 10に挙げられる主要な脆弱性（SQLインジェクション、XSS、CSRFなど）に対する対策を講じる。
- 4.3. 可用性 (Availability)
  - 4.3.1. サービス稼働率
    - 目標稼働率
      - MVP: 99.0%
      - 理想: 99.9%
  - 4.3.2. 障害復旧時間
    - 障害発生時の復旧時間（RTO）: 理想 1時間、許容 4時間、MVP 24時間
    - データ損失の許容範囲（RPO）: 理想 5分、許容 15分、MVP 1時間
- 4.4. 拡張性 (Scalability)
  - 4.4.1. ユーザー増加への対応
    - 主要なコンポーネント（アプリケーションサーバー、WebSocketサーバー、データベース等）をスケールアウトまたはスケールアップすることで対応可能なアーキテクチャとする。
  - 4.4.2. 機能追加の容易性
    - 新しい機能を追加する際に、既存のシステムへの影響を最小限に抑えられるようなモジュール化された設計を心がける。
- 4.5. 保守性 (Maintainability)
  - 4.5.1. コード品質
    - 一貫性のあるコーディング規約に従い、可読性の高いコードを記述する。主要なロジックにはコメントを付与する。docコメントも適宜記載する。コーディング規約は、ソロプロジェクトのため、MVPでは設定しない。
  - 4.5.3. バージョン管理
    - Gitを用いてソースコードのバージョン管理を適切に行う。
- 4.6. 運用性 (Operability)
  - 4.6.1. ロギング
    - 主要なシステムイベント、エラー、APIリクエストなどをログに出力し、一元的に確認・分析できる仕組みを導入する。
  - 4.6.2. モニタリング
    - CPU使用率、メモリ使用率、ネットワークトラフィック、エラーレートなどの主要なメトリクスを監視し、異常検知時にはアラートが通知されるようにする。
  - 4.6.3. デプロイ
    - アプリケーションのデプロイを自動化または半自動化し、迅速かつ安全に行えるようにする（例: Docker, Kubernetesの活用）。
